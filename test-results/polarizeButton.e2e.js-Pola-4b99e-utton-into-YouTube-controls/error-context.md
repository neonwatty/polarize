# Test info

- Name: Polarize Button Integration Tests >> should inject the Polarize button into YouTube controls
- Location: /Users/jeremywatt/Desktop/polarize/test/polarizeButton.e2e.js:12:3

# Error details

```
Error: expect(received).toBeTruthy()

Received: null
    at /Users/jeremywatt/Desktop/polarize/test/polarizeButton.e2e.js:18:28
```

# Page snapshot

```yaml
- dialog
- banner:
  - button "Guide"
  - link "YouTube Home":
    - /url: /
  - button "Skip navigation"
  - search:
    - combobox "Search" [expanded]
    - button "Search"
  - button "Search with your voice"
  - tooltip "tooltip"
  - button "Settings"
  - link "Sign in":
    - /url: https://accounts.google.com/ServiceLogin?service=youtube&uilel=3&passive=true&continue=https%3A%2F%2Fwww.youtube.com%2Fsignin%3Faction_handle_signin%3Dtrue%26app%3Ddesktop%26hl%3Den%26next%3Dhttps%253A%252F%252Fwww.youtube.com%252Fwatch%253Fv%253DdQw4w9WgXcQ&hl=en&ec=65620
- main:
  - complementary:
    - button "Show cards":
      - img
    - text: Rick Astley-Are We There Yet?
    - button "Channel watermark":
      - img "Channel watermark"
    - slider "Seek slider"
    - slider "Click or scroll the panel for the precise seeking."
    - button "Pause (k)":
      - img
    - button "Next (SHIFT+n)":
      - img
    - button "Mute (m)":
      - img
    - slider "Volume"
    - text: 0:00 / 3:32
    - button "Subtitles/closed captions unavailable":
      - img
    - button "Settings":
      - img
    - button "Miniplayer (i)":
      - img
    - button "Theater mode (t)":
      - img
    - button "Full screen (f)":
      - img
  - heading "Rick Astley - Never Gonna Give You Up (Official Music Video)" [level=1]
  - link:
    - /url: /@RickAstleyYT
  - link "Rick Astley":
    - /url: /channel/UCuAXFkgsw1L7xaCfnd5JJOw
  - tooltip "tooltip"
  - img "Official Artist Channel":
    - paragraph
    - tooltip "tooltip"
  - text: 4.32M subscribers
  - button "Subscribe to Rick Astley.": Subscribe
  - button "like this video along with 18,311,998 other people"
  - button "Dislike this video"
  - button "Share"
  - button "Save to playlist": Save
  - button "More actions"
  - text: 1,647,872,817 views 15 years ago
  - link "#RickAstley":
    - /url: /hashtag/rickastley
  - link "#NeverGonnaGiveYouUp":
    - /url: /hashtag/nevergonnagiveyouup
  - link "#OfficialMusicVideo":
    - /url: /hashtag/officialmusicvideo
  - tooltip "tooltip"
  - text: "The official video for ‚ÄúNever Gonna Give You Up‚Äù by Rick Astley. Never: The Autobiography üìö OUT NOW! ‚Ä¶"
  - button "...more"
  - link "Ultimate 80s Hits Dr. Jacksan Fernandes tooltip 500K views ‚Ä¢11 days ago":
    - /url: /watch?v=vlEbK-KFX68&pp=0gcJCX4JAYcqIYzv
    - heading "Ultimate 80s Hits" [level=3]
    - text: Dr. Jacksan Fernandes
    - tooltip "tooltip"
    - text: 500K views ‚Ä¢11 days ago
  - button "Action menu"
  - link "Ed Sheeran, Bruno Mars, Dua Lipa, Adele, Maroon 5, Rihanna, The Weeknd - Billboard Top 50 This Week Dreamy Vibez Music tooltip 3.6M views ‚Ä¢6 months ago":
    - /url: /watch?v=xhrE4M8J3FU
    - heading "Ed Sheeran, Bruno Mars, Dua Lipa, Adele, Maroon 5, Rihanna, The Weeknd - Billboard Top 50 This Week" [level=3]
    - text: Dreamy Vibez Music
    - tooltip "tooltip"
    - text: 3.6M views ‚Ä¢6 months ago
  - button "Action menu"
  - link "70s & 80s Dance & Soul Hits | Non-Stop Disco, Funk & Pop Party Mix SUPREMACY SOUNDS tooltip 1.4M views ‚Ä¢5 months ago":
    - /url: /watch?v=-rS1yX64IZc
    - heading "70s & 80s Dance & Soul Hits | Non-Stop Disco, Funk & Pop Party Mix" [level=3]
    - text: SUPREMACY SOUNDS
    - tooltip "tooltip"
    - text: 1.4M views ‚Ä¢5 months ago
  - button "Action menu"
  - link "Rick Astley - Together Forever (Official HD Video) Rick Astley tooltip Official Artist Channel 21M views ‚Ä¢5 years ago":
    - /url: /watch?v=E9de-cmycx8
    - heading "Rick Astley - Together Forever (Official HD Video)" [level=3]
    - text: Rick Astley
    - tooltip "tooltip"
    - img "Official Artist Channel":
      - paragraph
      - tooltip "tooltip"
    - text: 21M views ‚Ä¢5 years ago
  - button "Action menu"
  - link "Best of R&B Classics 90s & 2000s ~ Old School R&B Music Ever üé∂ Ne Yo, Nelly, Akon, Rihanna, Usher R&B Old Skool Mix tooltip 5.3M views ‚Ä¢9 months ago":
    - /url: /watch?v=lofbNZ7vMSo
    - heading "Best of R&B Classics 90s & 2000s ~ Old School R&B Music Ever üé∂ Ne Yo, Nelly, Akon, Rihanna, Usher" [level=3]
    - text: R&B Old Skool Mix
    - tooltip "tooltip"
    - text: 5.3M views ‚Ä¢9 months ago
  - button "Action menu"
  - link "back to 1990s ~roadtrip playlist ~1990s throwback vibes mix Amazing Melody ‚ô´ tooltip 1.3M views ‚Ä¢2 months ago":
    - /url: /watch?v=VvRFH5G_7XM
    - heading "back to 1990s ~roadtrip playlist ~1990s throwback vibes mix" [level=3]
    - text: Amazing Melody ‚ô´
    - tooltip "tooltip"
    - text: 1.3M views ‚Ä¢2 months ago
  - button "Action menu"
  - link "Greatest Hits 1980s One Hits Wonder Of All Time - The Best Of 80s Old Music Hits Playlist Ever#m44 80s MUSIC tooltip 463K views ‚Ä¢1 month ago":
    - /url: /watch?v=lQj_7QBQLZY
    - heading "Greatest Hits 1980s One Hits Wonder Of All Time - The Best Of 80s Old Music Hits Playlist Ever#m44" [level=3]
    - text: 80s MUSIC
    - tooltip "tooltip"
    - text: 463K views ‚Ä¢1 month ago
  - button "Action menu"
  - link "Tears For Fears - Everybody Wants To Rule The World (Official Music Video) Tears For Fears tooltip Official Artist Channel 513M views ‚Ä¢11 years ago":
    - /url: /watch?v=aGCdLKXNF3w
    - heading "Tears For Fears - Everybody Wants To Rule The World (Official Music Video)" [level=3]
    - text: Tears For Fears
    - tooltip "tooltip"
    - img "Official Artist Channel":
      - paragraph
      - tooltip "tooltip"
    - text: 513M views ‚Ä¢11 years ago
  - button "Action menu"
  - link "Elton John, Lionel Richie, Bee Gees, Phil Collins, Foreigner üìÄ Best Soft Rock Love Songs 70s 80s 90s Soft Rock Playlist tooltip 3.7M views ‚Ä¢4 months ago":
    - /url: /watch?v=krMwB2Mw7DQ
    - heading "Elton John, Lionel Richie, Bee Gees, Phil Collins, Foreigner üìÄ Best Soft Rock Love Songs 70s 80s 90s" [level=3]
    - text: Soft Rock Playlist
    - tooltip "tooltip"
    - text: 3.7M views ‚Ä¢4 months ago
  - button "Action menu"
  - 'link "The Story of the Best Meme EVER: \"Never Gonna Give You Up\" & Rickrolling Alfo Media tooltip Verified 4.7M views ‚Ä¢4 years ago"':
    - /url: /watch?v=QMW4AqbuSGg
    - 'heading "The Story of the Best Meme EVER: \"Never Gonna Give You Up\" & Rickrolling" [level=3]'
    - text: Alfo Media
    - tooltip "tooltip"
    - img "Verified":
      - paragraph
      - tooltip "tooltip"
    - text: 4.7M views ‚Ä¢4 years ago
  - button "Action menu"
  - link "some 80s music my dad still listens to til this day we vibin‚Äô tooltip 12M views ‚Ä¢3 years ago":
    - /url: /watch?v=D4i1J90oNEg
    - heading "some 80s music my dad still listens to til this day" [level=3]
    - text: we vibin‚Äô
    - tooltip "tooltip"
    - text: 12M views ‚Ä¢3 years ago
  - button "Action menu"
  - link "80s car songs Dr. Jacksan Fernandes tooltip 260K views ‚Ä¢2 months ago":
    - /url: /watch?v=t6YQBnn-elI
    - heading "80s car songs" [level=3]
    - text: Dr. Jacksan Fernandes
    - tooltip "tooltip"
    - text: 260K views ‚Ä¢2 months ago
  - button "Action menu"
  - link "Metallica, Queen, Nirvana, Guns N Roses, Bon Jovi, ACDC üî• Best Classic Rock Songs 70s 80s 90s Classic Rock Music tooltip 8.5M views ‚Ä¢6 months ago":
    - /url: /watch?v=aeBmia24CQQ
    - heading "Metallica, Queen, Nirvana, Guns N Roses, Bon Jovi, ACDC üî• Best Classic Rock Songs 70s 80s 90s" [level=3]
    - text: Classic Rock Music
    - tooltip "tooltip"
    - text: 8.5M views ‚Ä¢6 months ago
  - button "Action menu"
  - link "Ed Sheeran, Bruno Mars, Dua Lipa, Adele, Maroon 5, Rihanna, The Weeknd - Pop music 2024 Dreamy Vibez Music tooltip 3.5M views ‚Ä¢6 months ago":
    - /url: /watch?v=IuLW2UjTgMs
    - heading "Ed Sheeran, Bruno Mars, Dua Lipa, Adele, Maroon 5, Rihanna, The Weeknd - Pop music 2024" [level=3]
    - text: Dreamy Vibez Music
    - tooltip "tooltip"
    - text: 3.5M views ‚Ä¢6 months ago
  - button "Action menu"
  - link "Never Gonna Mix You Up (Part 2) - Rick Astley DJ Nick tooltip 264K views ‚Ä¢1 year ago":
    - /url: /watch?v=1E30uKYHiEk
    - heading "Never Gonna Mix You Up (Part 2) - Rick Astley" [level=3]
    - text: DJ Nick
    - tooltip "tooltip"
    - text: 264K views ‚Ä¢1 year ago
  - button "Action menu"
  - link "Best of Old School 90's 2000's Rnb Music Hits üéµUsher, Akon, Rihanna, Nelly, Ne-Yo R & B Music tooltip 6.4M views ‚Ä¢6 months ago":
    - /url: /watch?v=NFq0BQvLOpc
    - heading "Best of Old School 90's 2000's Rnb Music Hits üéµUsher, Akon, Rihanna, Nelly, Ne-Yo" [level=3]
    - text: R & B Music
    - tooltip "tooltip"
    - text: 6.4M views ‚Ä¢6 months ago
  - button "Action menu"
  - link "Daft Punk ft. Pharell Williams Get lucky Extended Version Original Video Full HD pfigueroah tooltip 18M views ‚Ä¢11 years ago":
    - /url: /watch?v=0QVOc1aagSE
    - heading "Daft Punk ft. Pharell Williams Get lucky Extended Version Original Video Full HD" [level=3]
    - text: pfigueroah
    - tooltip "tooltip"
    - text: 18M views ‚Ä¢11 years ago
  - button "Action menu"
  - 'link "80s Greatest Hits - Madonna, Cyndi Lauper, Modern Talking, Laura Branigan, Michael Jackson #m47 80s MUSIC tooltip 2.7M views ‚Ä¢3 weeks ago"':
    - /url: /watch?v=Ns7GNo_Y3K8
    - 'heading "80s Greatest Hits - Madonna, Cyndi Lauper, Modern Talking, Laura Branigan, Michael Jackson #m47" [level=3]'
    - text: 80s MUSIC
    - tooltip "tooltip"
    - text: 2.7M views ‚Ä¢3 weeks ago
  - button "Action menu"
  - link "80s Mix I - Pop Rock | üéµ Queen, Baltimora, Rick Astley, Michael Jackson, Pet Shop Boys, etc Alejandro Barrera Dj tooltip 46M views ‚Ä¢1 year ago":
    - /url: /watch?v=WdhwU_JCINw
    - heading "80s Mix I - Pop Rock | üéµ Queen, Baltimora, Rick Astley, Michael Jackson, Pet Shop Boys, etc" [level=3]
    - text: Alejandro Barrera Dj
    - tooltip "tooltip"
    - text: 46M views ‚Ä¢1 year ago
  - button "Action menu"
  - link "Backstreet Boys Best Hits | Best Song Collection of BSB YT STUDIOS tooltip 2.9M views ‚Ä¢1 year ago":
    - /url: /watch?v=XCw3dFgrVBg
    - heading "Backstreet Boys Best Hits | Best Song Collection of BSB" [level=3]
    - text: YT STUDIOS
    - tooltip "tooltip"
    - text: 2.9M views ‚Ä¢1 year ago
  - button "Action menu"
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test.describe('Polarize Button Integration Tests', () => {
   4 |   let page;
   5 |
   6 |   test.beforeAll(async ({ browser }) => {
   7 |     const context = await browser.newContext();
   8 |     page = await context.newPage();
   9 |     await page.goto('https://www.youtube.com/watch?v=dQw4w9WgXcQ'); // Example YouTube video
  10 |   });
  11 |
  12 |   test('should inject the Polarize button into YouTube controls', async () => {
  13 |     // Wait for the YouTube controls to load
  14 |     await page.waitForSelector('.ytp-left-controls');
  15 |
  16 |     // Check if the Polarize button is injected
  17 |     const polarizeButton = await page.$('#polarize-toggle');
> 18 |     expect(polarizeButton).toBeTruthy();
     |                            ^ Error: expect(received).toBeTruthy()
  19 |
  20 |     // Verify button attributes
  21 |     const title = await polarizeButton.getAttribute('title');
  22 |     expect(title).toBe('Toggle Polarize Controls');
  23 |   });
  24 |
  25 |   test('should toggle the overlay when the button is clicked', async () => {
  26 |     const polarizeButton = await page.$('#polarize-toggle');
  27 |
  28 |     // Click the button to create the overlay
  29 |     await polarizeButton.click();
  30 |     const overlay = await page.$('#code-overlay');
  31 |     expect(overlay).toBeTruthy();
  32 |
  33 |     // Click the button again to remove the overlay
  34 |     await polarizeButton.click();
  35 |     const overlayRemoved = await page.$('#code-overlay');
  36 |     expect(overlayRemoved).toBeNull();
  37 |   });
  38 |
  39 |   test('should capture a snapshot and display extracted code', async () => {
  40 |     const polarizeButton = await page.$('#polarize-toggle');
  41 |
  42 |     // Click the button to create the overlay
  43 |     await polarizeButton.click();
  44 |
  45 |     // Mock the API response
  46 |     await page.route('https://api.example.com/extract', (route) =>
  47 |       route.fulfill({
  48 |         status: 200,
  49 |         body: JSON.stringify({
  50 |           language: 'javascript',
  51 |           code: 'console.log("Hello, world!");',
  52 |         }),
  53 |       })
  54 |     );
  55 |
  56 |     // Simulate capturing a snapshot
  57 |     const extractButton = await page.$('#extract-btn');
  58 |     await extractButton.click();
  59 |
  60 |     // Wait for the modal to appear
  61 |     const modal = await page.waitForSelector('.code-modal');
  62 |     expect(modal).toBeTruthy();
  63 |
  64 |     // Verify the extracted code
  65 |     const codeContent = await modal.textContent();
  66 |     expect(codeContent).toContain('console.log("Hello, world!");');
  67 |   });
  68 | });
```